<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Lessons for the Materials Project Workshop"><link href=https://workshop.materialsproject.org/lessons/05_automated_dft/Lesson/ rel=canonical><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.2.2, mkdocs-material-7.2.2"><title>Automated DFT - The Materials Project Workshop</title><link rel=stylesheet href=../../../assets/stylesheets/main.1118c9be.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.ba0d045b.min.css><meta name=theme-color content=#546d78><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/workshop.css><link rel=stylesheet href=../../../css/ansi-colours.css><link rel=stylesheet href=../../../css/jupyter-cells.css><link rel=stylesheet href=../../../css/pandas-dataframe.css></head> <body dir=ltr data-md-color-scheme data-md-color-primary=blue-grey data-md-color-accent> <script>function __prefix(e){return new URL("../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#automated-dft class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="The Materials Project Workshop" class="md-header__button md-logo" aria-label="The Materials Project Workshop" data-md-component=logo> <img src=../../../assets/materials_project_logo_white.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> The Materials Project Workshop </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Automated DFT </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/materialsproject/workshop/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="The Materials Project Workshop" class="md-nav__button md-logo" aria-label="The Materials Project Workshop" data-md-component=logo> <img src=../../../assets/materials_project_logo_white.svg alt=logo> </a> The Materials Project Workshop </label> <div class=md-nav__source> <a href=https://github.com/materialsproject/workshop/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../../../logistics/logistics/ class=md-nav__link> Logistics </a> </li> <li class=md-nav__item> <a href=../../../people/people/ class=md-nav__link> People </a> </li> <li class=md-nav__item> <a href=../../../code_of_conduct/ class=md-nav__link> Code of Conduct </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Primer <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Primer data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Primer </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../primer/01_basic_python/0%20-%20Introduction%20and%20Jupyter%20Use/ class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../../primer/01_basic_python/1%20-%20Python%20Primer/ class=md-nav__link> Basic Python </a> </li> <li class=md-nav__item> <a href=../../../primer/02_python_part2/lessons/ class=md-nav__link> Advanced Python </a> </li> <li class=md-nav__item> <a href=../../../primer/03_MongoDB_part1/lessons_filled/ class=md-nav__link> Intro to MongoDB </a> </li> <li class=md-nav__item> <a href=../../../primer/04_Python_environments/1_pip_and_conda/ class=md-nav__link> Intro to Python Environments </a> </li> <li class=md-nav__item> <a href=../../../primer/04_Python_environments/2_google_colab/ class=md-nav__link> Intro to Google Colab </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6 checked> <label class=md-nav__link for=__nav_6> Workshop <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Workshop data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Workshop </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_1 type=checkbox id=__nav_6_1> <label class=md-nav__link for=__nav_6_1> Day 1 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Day 1" data-md-level=2> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> Day 1 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../01_website_walkthrough/website_walkthrough/ class=md-nav__link> The Materials Project Website </a> </li> <li class=md-nav__item> <a href=../../02_intro_pymatgen/1%20-%20pymatgen%20foundations/ class=md-nav__link> Intro to Pymatgen </a> </li> <li class=md-nav__item> <a href=../../03_surfaces/Working%20With%20Surfaces_lesson/ class=md-nav__link> Working with Surfaces </a> </li> <li class=md-nav__item> <a href=../../04_materials_api/MAPI%20Lesson%20%28filled%29/ class=md-nav__link> The Materials API </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_2 type=checkbox id=__nav_6_2 checked> <label class=md-nav__link for=__nav_6_2> Day 2 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Day 2" data-md-level=2> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> Day 2 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Automated DFT <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Automated DFT </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#core-concepts class=md-nav__link> Core Concepts </a> </li> <li class=md-nav__item> <a href=#lesson-1-writing-input-files class=md-nav__link> Lesson 1: Writing Input Files </a> <nav class=md-nav aria-label="Lesson 1: Writing Input Files"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#poscar-demonstration class=md-nav__link> POSCAR Demonstration </a> </li> <li class=md-nav__item> <a href=#input-sets class=md-nav__link> Input Sets </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#lesson-2-parsing-output-files class=md-nav__link> Lesson 2: Parsing Output Files </a> <nav class=md-nav aria-label="Lesson 2: Parsing Output Files"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#vasprun-demonstration class=md-nav__link> Vasprun Demonstration </a> </li> <li class=md-nav__item> <a href=#parsing-directories-with-atomate-drones class=md-nav__link> Parsing Directories with Atomate Drones </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#lesson-3-database-automation class=md-nav__link> Lesson 3: Database Automation </a> <nav class=md-nav aria-label="Lesson 3: Database Automation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#getting-workflows class=md-nav__link> Getting Workflows </a> </li> <li class=md-nav__item> <a href=#launching-workflows-from-your-launchpad class=md-nav__link> Launching Workflows from Your LaunchPad </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../06_new_systems/06%20-%20New%20Systems%20-%20filled/ class=md-nav__link> Exploring New Systems </a> </li> <li class=md-nav__item> <a href=../../07_mpcontribs/contribute/ class=md-nav__link> MPContribs </a> </li> <li class=md-nav__item> <a href=../../08_ml_matminer/matminer-notes/ class=md-nav__link> Machine Learning with MatMiner </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#core-concepts class=md-nav__link> Core Concepts </a> </li> <li class=md-nav__item> <a href=#lesson-1-writing-input-files class=md-nav__link> Lesson 1: Writing Input Files </a> <nav class=md-nav aria-label="Lesson 1: Writing Input Files"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#poscar-demonstration class=md-nav__link> POSCAR Demonstration </a> </li> <li class=md-nav__item> <a href=#input-sets class=md-nav__link> Input Sets </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#lesson-2-parsing-output-files class=md-nav__link> Lesson 2: Parsing Output Files </a> <nav class=md-nav aria-label="Lesson 2: Parsing Output Files"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#vasprun-demonstration class=md-nav__link> Vasprun Demonstration </a> </li> <li class=md-nav__item> <a href=#parsing-directories-with-atomate-drones class=md-nav__link> Parsing Directories with Atomate Drones </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#lesson-3-database-automation class=md-nav__link> Lesson 3: Database Automation </a> <nav class=md-nav aria-label="Lesson 3: Database Automation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#getting-workflows class=md-nav__link> Getting Workflows </a> </li> <li class=md-nav__item> <a href=#launching-workflows-from-your-launchpad class=md-nav__link> Launching Workflows from Your LaunchPad </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/materialsproject/workshop/edit/master/docs/lessons/05_automated_dft/Lesson.ipynb title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <script src=https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js></script> <script>
(function() {
  function addWidgetsRenderer() {
    var mimeElement = document.querySelector('script[type="application/vnd.jupyter.widget-view+json"]');
    var scriptElement = document.createElement('script');
    var widgetRendererSrc = 'https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js';
    var widgetState;

    // Fallback for older version:
    try {
      widgetState = mimeElement && JSON.parse(mimeElement.innerHTML);

      if (widgetState && (widgetState.version_major < 2 || !widgetState.version_major)) {
        widgetRendererSrc = 'jupyter-js-widgets@*/dist/embed.js';
      }
    } catch(e) {}

    scriptElement.src = widgetRendererSrc;
    document.body.appendChild(scriptElement);
  }

  document.addEventListener('DOMContentLoaded', addWidgetsRenderer);
}());
</script> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h1 id=automated-dft>Automated DFT<a class=headerlink href=#automated-dft title="Permanent link">&para;</a></h1> <p>This lesson focuses on key concepts necessary to run automated Density Functional Theory (DFT) workflows using our atomate code. We begin by focusing on using pymatgen to build inputs and parsing outputs of DFT calculations. Then we will go through a demonstration of using atomate to run DFT calculations.</p> <h2 id=core-concepts>Core Concepts<a class=headerlink href=#core-concepts title="Permanent link">&para;</a></h2> <ul> <li><strong>Writing Input Files</strong> - There is an enitre module in pymatgen devoted to reading and writing the input and output files of other codes to assist in calculation automation.</li> <li><strong>Parsing Output Files</strong> - Similar to handling input files, pymatgen also supports parsing output files. This machinery is also used by automate to parse entire output directories.</li> <li><strong>Database Automation</strong> - Atomate combines everything needed to automate running DFT calculations and storing them in a database.</li> </ul> <p>For this lesson to work, we'll need to setup pymatgen with some files, pseudopotential that describe the charge density around each element, that typically are only available to registered VASP users. We've made some fake files with the correct structure so that pymatgen will still function.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>mp_workshop</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_subarea output_stream output_stdout output_text"> <pre>
<code>FW Echo Test: MP Workshop
</code>
</pre> </div> </div> <div class=output_area> <div class="output_subarea output_stream output_stderr output_text"> <pre>
<code>/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/maggma/utils.py:20: TqdmExperimentalWarning: Using `tqdm.autonotebook.tqdm` in notebook mode. Use `tqdm.tqdm` instead to force console mode (e.g. in jupyter console)
  from tqdm.autonotebook import tqdm
</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h2 id=lesson-1-writing-input-files>Lesson 1: Writing Input Files<a class=headerlink href=#lesson-1-writing-input-files title="Permanent link">&para;</a></h2> <p>For the first lesson we'll focus on using pymatgen to simplfy interfacing with DFT codes. Pymatgen has a IO (input/output) module which has methods to parse and write files that are compatible with a number of external codes. These external codes are written in coding languages other than python (e.g. Fortran, C, C++, etc.) but pymatgen's IO module allows us to interface with them all through python. These external codes include:</p> <ul> <li>AbInit</li> <li>EXCITING</li> <li>FEFF</li> <li>LAMMPS</li> <li>Lobster</li> <li>QChem</li> <li>VASP</li> <li>ATAT</li> <li>Gaussian</li> <li>NWCHem</li> <li>ShengBTE</li> <li>Wannier90</li> <li>Zeo++</li> </ul> <p>For today's lesson, we will focus on one of these codes, VASP (Vienna Ab initio Simulation Package), which is a DFT code for atomic scale materials modeling. VASP is the DFT code used by the Materials Project for inorganic crystals. We will also use a second DFT code, Q-Chem, in the exercises which is used by the Materials Project for molecules.</p> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h3 id=poscar-demonstration>POSCAR Demonstration<a class=headerlink href=#poscar-demonstration title="Permanent link">&para;</a></h3> <p>Let's begin by obtaining a silicon structure to use in today's lesson. We will import this structure from a CIF (Crystallographic Information File) file which is not compatible with many DFT codes.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>pymatgen.core</span> <span class=kn>import</span> <span class=n>Structure</span>
<span class=n>struct</span> <span class=o>=</span> <span class=n>Structure</span><span class=o>.</span><span class=n>from_file</span><span class=p>(</span><span class=n>filename</span><span class=o>=</span><span class=s2>&quot;./example_files/Si.CIF&quot;</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=n>struct</span><span class=p>)</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_subarea output_stream output_stdout output_text"> <pre>
<code>Full Formula (Si8)
Reduced Formula: Si
abc   :   5.523145   5.468728   5.468728
angles:  90.000000  90.000000  90.000000
Sites (8)
  #  SP       a     b     c
---  ----  ----  ----  ----
  0  Si    0.25  0.25  0.25
  1  Si    0.5   0.5   0
  2  Si    0.25  0.75  0.75
  3  Si    0.5   0     0.5
  4  Si    0.75  0.25  0.75
  5  Si    0     0.5   0.5
  6  Si    0.75  0.75  0.25
  7  Si    0     0     0
</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>VASP has 4 types of input files that must be provided by the user to run a calculation: * <strong>INCAR:</strong> specifies modeling parameters (how to run the calculation) * <strong>POSCAR:</strong> provides atomic structure * <strong>KPOINTS:</strong> outlines points for sampling space in the simulation cell * <strong>POTCAR:</strong> describes how to simulate electrons via pseudopotentials</p> <p>Pymatgen has python objects for representing each type of input file. For this lesson, we will first focus on the POSCAR to demonstrate the capabilties of these python objects.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>pymatgen.io.vasp.inputs</span> <span class=kn>import</span> <span class=n>Poscar</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>Let's obtain a Poscar python object using the silicon structure object from before. </p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>poscar</span> <span class=o>=</span> <span class=n>Poscar</span><span class=p>(</span><span class=n>structure</span><span class=o>=</span><span class=n>struct</span><span class=p>,</span><span class=n>comment</span><span class=o>=</span><span class=s2>&quot;silicon&quot;</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=n>poscar</span><span class=p>)</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_subarea output_stream output_stdout output_text"> <pre>
<code>silicon
1.0
5.523145 0.000000 0.000000
0.000000 5.468728 0.000000
0.000000 0.000000 5.468728
Si
8
direct
0.250000 0.250000 0.250000 Si
0.500000 0.500000 0.000000 Si
0.250000 0.750000 0.750000 Si
0.500000 0.000000 0.500000 Si
0.750000 0.250000 0.750000 Si
0.000000 0.500000 0.500000 Si
0.750000 0.750000 0.250000 Si
0.000000 0.000000 0.000000 Si

</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>Since we can construct POSCARs from any structure object, we can make modifications to structure objects (make supercells, remove atoms to form defects, etc.) and construct complex structures (e.g. heterostructures, adsorbates on surfaces, etc.) all using pymatgen before turning the structure into a POSCAR file. </p> <p>In this Poscar object there is a full pymatgen structure that we can manipulate pythonically. To demonstrate, let's introduce a defect by removing the first site. To check our work, we look at how the Poscar has changed and print out the number of sites in our original struct (8) and the Poscar structure (7).</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>poscar</span><span class=o>.</span><span class=n>structure</span><span class=o>.</span><span class=n>remove_sites</span><span class=p>([</span><span class=mi>0</span><span class=p>])</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=nb>print</span><span class=p>(</span><span class=n>poscar</span><span class=p>)</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_subarea output_stream output_stdout output_text"> <pre>
<code>silicon
1.0
5.523145 0.000000 0.000000
0.000000 5.468728 0.000000
0.000000 0.000000 5.468728
Si
7
direct
0.500000 0.500000 0.000000 Si
0.250000 0.750000 0.750000 Si
0.500000 0.000000 0.500000 Si
0.750000 0.250000 0.750000 Si
0.000000 0.500000 0.500000 Si
0.750000 0.750000 0.250000 Si
0.000000 0.000000 0.000000 Si

</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=nb>print</span><span class=p>(</span><span class=n>struct</span><span class=o>.</span><span class=n>num_sites</span><span class=p>,</span><span class=n>poscar</span><span class=o>.</span><span class=n>structure</span><span class=o>.</span><span class=n>num_sites</span><span class=p>)</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_subarea output_stream output_stdout output_text"> <pre>
<code>8 7
</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>When your structure is ready, in order to obtain our POSCAR file for running VASP, the Poscar object has a method for writing it out as a file.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>poscar</span><span class=o>.</span><span class=n>write_file</span><span class=p>(</span><span class=n>filename</span><span class=o>=</span><span class=s2>&quot;POSCAR&quot;</span><span class=p>)</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>Another useful method is getting a Poscar object from a POSCAR file that has already been written. Note you are able to import a compressed file without unzipping it.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>poscar_from_file</span> <span class=o>=</span> <span class=n>Poscar</span><span class=o>.</span><span class=n>from_file</span><span class=p>(</span><span class=n>filename</span><span class=o>=</span><span class=s2>&quot;./example_files/POSCAR.gz&quot;</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=n>poscar_from_file</span><span class=p>)</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_subarea output_stream output_stdout output_text"> <pre>
<code>Al16 Cr10
1.0
7.417988 0.000000 -2.655322
-3.770804 6.388081 -2.655321
0.000000 0.000000 7.878914
Al Cr
16 10
direct
0.696455 0.696455 0.696455 Al
0.646563 0.002044 0.646563 Al
0.646563 0.646563 0.002044 Al
0.002044 0.646563 0.646563 Al
0.336523 0.558569 0.336523 Al
0.336523 0.336523 0.558569 Al
0.558569 0.336523 0.336523 Al
0.734771 0.383622 0.734771 Al
0.734771 0.734771 0.383622 Al
0.383622 0.734771 0.734771 Al
0.280797 0.666745 0.038053 Al
0.038053 0.280797 0.666745 Al
0.666745 0.038053 0.280797 Al
0.666745 0.280797 0.038053 Al
0.038053 0.666745 0.280797 Al
0.280797 0.038053 0.666745 Al
0.151124 0.151124 0.151124 Cr
0.015343 0.797266 0.015343 Cr
0.015343 0.015343 0.797266 Cr
0.797266 0.015343 0.015343 Cr
0.987828 0.333690 0.987828 Cr
0.987828 0.987828 0.333690 Cr
0.333690 0.987828 0.987828 Cr
0.365023 0.015932 0.365023 Cr
0.365023 0.365023 0.015932 Cr
0.015932 0.365023 0.365023 Cr

</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>All the python objects for VASP inputs (INCAR, POSCAR, KPOINTS, POTCAR) have similar methods for initiating the object and writing out files. See the pymatgen documentation for more details: https://pymatgen.org/_modules/pymatgen/io/vasp/inputs.html</p> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h3 id=input-sets>Input Sets<a class=headerlink href=#input-sets title="Permanent link">&para;</a></h3> <p>It can still take quite some effort to explicitly generate each input file needed for calculation. To further automatation, pymatgen builds upon these pieces to generate <code>InputSets</code>. InputSets are objects that provide default parameters to perform a specific kind of calcualtion. Pymatgen has several InputSets including ones with the default paramters used for MP calculations. But it is also possible to define your own InputSet that lets you build new calculations using the parameters you want.</p> <p>Let's continue with our silicon structure from before. To generate the remaining input files needed for a VASP calculation, let's use an InputSet object. To perform a structure relaxation, we can import the parameters used in the Materials Project from <code>MPRelaxSet</code>.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>pymatgen.io.vasp.sets</span> <span class=kn>import</span> <span class=n>MPRelaxSet</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>Note all we need to initiate the MPRelaxSet InputSet is a structure object. All the information we need to generate the four VASP input files can be determined from the provided structure.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>relax_set</span> <span class=o>=</span> <span class=n>MPRelaxSet</span><span class=p>(</span><span class=n>structure</span><span class=o>=</span><span class=n>struct</span><span class=p>)</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>We can access the pythonic object for each of the VASP Input files (INCAR, POSCAR, KPOINTS, POTCAR) from our InputSet object.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>relax_set</span><span class=o>.</span><span class=n>incar</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_text output_subarea output_execute_result"> <pre>
<code>{&#39;ALGO&#39;: &#39;Fast&#39;,
 &#39;EDIFF&#39;: 0.0004,
 &#39;ENCUT&#39;: 520,
 &#39;IBRION&#39;: 2,
 &#39;ISIF&#39;: 3,
 &#39;ISMEAR&#39;: -5,
 &#39;ISPIN&#39;: 2,
 &#39;LASPH&#39;: True,
 &#39;LORBIT&#39;: 11,
 &#39;LREAL&#39;: &#39;Auto&#39;,
 &#39;LWAVE&#39;: False,
 &#39;NELM&#39;: 100,
 &#39;NSW&#39;: 99,
 &#39;PREC&#39;: &#39;Accurate&#39;,
 &#39;SIGMA&#39;: 0.05,
 &#39;MAGMOM&#39;: [0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6]}</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>relax_set</span><span class=o>.</span><span class=n>poscar</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_text output_subarea output_execute_result"> <pre>
<code>Si8
1.0
5.523145 0.000000 0.000000
0.000000 5.468728 0.000000
0.000000 0.000000 5.468728
Si
8
direct
0.250000 0.250000 0.250000 Si
0.500000 0.500000 0.000000 Si
0.250000 0.750000 0.750000 Si
0.500000 0.000000 0.500000 Si
0.750000 0.250000 0.750000 Si
0.000000 0.500000 0.500000 Si
0.750000 0.750000 0.250000 Si
0.000000 0.000000 0.000000 Si</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>relax_set</span><span class=o>.</span><span class=n>kpoints</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_text output_subarea output_execute_result"> <pre>
<code>pymatgen with grid density = 769 / number of atoms
0
Monkhorst
4 4 4</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>relax_set</span><span class=o>.</span><span class=n>potcar</span><span class=o>.</span><span class=n>as_dict</span><span class=p>()</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_text output_subarea output_execute_result"> <pre>
<code>{&#39;functional&#39;: &#39;PBE&#39;,
 &#39;symbols&#39;: [&#39;Si&#39;],
 &#39;@module&#39;: &#39;pymatgen.io.vasp.inputs&#39;,
 &#39;@class&#39;: &#39;Potcar&#39;}</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>InputSet has a <code>.write_input()</code> method which will write out all the VASP input files we need to run a structure optimization for our silicon structure. Let's specify writing our input files to a directory as if we were going to launch VASP from that directory.</p> <p>Note we will also set the <code>potcar_spec=True</code> flag to avoid writing an actual POTCAR file (which is composed from POTCAR files that can only be distrubuted under a VASP license). By default, POTCARs will be written based on POTCARs specifed by the environment variable <code>PMG_VASP_PSP_DIR</code>.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>relax_set</span><span class=o>.</span><span class=n>write_input</span><span class=p>(</span><span class=n>output_dir</span><span class=o>=</span><span class=s2>&quot;./Si_MPRelaxSet&quot;</span><span class=p>,</span><span class=n>potcar_spec</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h2 id=lesson-2-parsing-output-files>Lesson 2: Parsing Output Files<a class=headerlink href=#lesson-2-parsing-output-files title="Permanent link">&para;</a></h2> <p>After VASP has been run, you'll need to parse the VASP outputs to get the data you want. VASP makes a number of output files: </p> <ul> <li>WAVECAR</li> <li>CHGCAR</li> <li>OUTCAR</li> <li>vasprun.xml</li> <li>PROCAR</li> <li>And more ...</li> </ul> <p>Please refer to <a href=https://www.vasp.at/wiki/index.php/The_VASP_Manual>VASP's documentation</a> for descriptions of what these all are. </p> <h3 id=vasprun-demonstration>Vasprun Demonstration<a class=headerlink href=#vasprun-demonstration title="Permanent link">&para;</a></h3> <p>For this portion of the lesson, we'll focus on vasprun.xml.gz in the example_VASP_Al16Cr10 directory. Similar to how pymatgen has objects corresponding to VASP input files, pymatgen has a <code>Vasprun</code> python object for parsing the outputs contained in vasprun.xml files.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>pymatgen.io.vasp.outputs</span> <span class=kn>import</span> <span class=n>Vasprun</span>
<span class=n>vrun</span> <span class=o>=</span> <span class=n>Vasprun</span><span class=p>(</span><span class=n>filename</span><span class=o>=</span><span class=s2>&quot;./example_VASP_Al16Cr10/vasprun.xml.gz&quot;</span><span class=p>)</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_subarea output_stream output_stderr output_text"> <pre>
<code>/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/pymatgen/io/vasp/inputs.py:1792: UnknownPotcarWarning: POTCAR with symbol Al has metadata that does not match                          any VASP POTCAR known to pymatgen. The data in this                          POTCAR is known to match the following functionals:                          [&#39;PBE&#39;]
  warnings.warn(
/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/pymatgen/io/vasp/inputs.py:1792: UnknownPotcarWarning: POTCAR with symbol Cr_pv has metadata that does not match                          any VASP POTCAR known to pymatgen. The data in this                          POTCAR is known to match the following functionals:                          [&#39;PBE&#39;]
  warnings.warn(
</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>Since Vasprun objects have most of the information that VASP can provide, this one object is often enough to parse a full VASP calculation. Use vrun.+Tab to check out the properties from the Vasprun object. </p> <p>For example, we can check if the calculation is converged as well as the the final structure and energy after the structure optimization was finished.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>vrun</span><span class=o>.</span><span class=n>converged</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_text output_subarea output_execute_result"> <pre>
<code>True</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>vrun</span><span class=o>.</span><span class=n>final_structure</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_text output_subarea output_execute_result"> <pre>
<code>Structure Summary
Lattice
    abc : 7.858339351222918 7.858486224302677 7.857828722726137
 angles : 109.68307448574032 109.6862509307799 109.68598356491901
 volume : 370.5637945511443
      A : 7.41150067 -0.06594902 -2.61128434
      B : -3.66951308 6.43992452 -2.61110162
      C : -0.0388319 -0.06592473 7.85745622
PeriodicSite: Al (2.5789, 4.3928, 1.8349) [0.6964, 0.6964, 0.6964]
PeriodicSite: Al (4.7570, -0.0715, 3.3849) [0.6463, 0.0021, 0.6463]
PeriodicSite: Al (2.4184, 4.1194, -3.3584) [0.6463, 0.6463, 0.0021]
PeriodicSite: Al (-2.3810, 4.1196, 3.3853) [0.0021, 0.6463, 0.6463]
PeriodicSite: Al (0.4331, 3.5525, 0.3080) [0.3367, 0.5585, 0.3367]
PeriodicSite: Al (1.2385, 2.1091, 2.6301) [0.3367, 0.3367, 0.5585]
PeriodicSite: Al (2.8908, 2.1093, 0.3082) [0.5585, 0.3367, 0.3367]
PeriodicSite: Al (4.0091, 2.3707, 2.8527) [0.7345, 0.3832, 0.7345]
PeriodicSite: Al (2.7336, 4.6565, -0.8251) [0.7345, 0.7345, 0.3832]
PeriodicSite: Al (0.1161, 4.6564, 2.8529) [0.3832, 0.7345, 0.7345]
PeriodicSite: Al (-0.3646, 4.2729, -2.1752) [0.2811, 0.6668, 0.0382]
PeriodicSite: Al (-0.7746, 1.7638, 4.4054) [0.0382, 0.2811, 0.6668]
PeriodicSite: Al (4.7905, 0.1830, 0.3684) [0.6667, 0.0381, 0.2811]
PeriodicSite: Al (3.9084, 1.7639, -2.1754) [0.6667, 0.2811, 0.0381]
PeriodicSite: Al (-2.1748, 4.2731, 0.3682) [0.0382, 0.6668, 0.2811]
PeriodicSite: Al (1.9175, 0.1832, 4.4051) [0.2811, 0.0381, 0.6667]
PeriodicSite: Cr (0.5570, 0.9483, 0.3962) [0.1504, 0.1503, 0.1504]
PeriodicSite: Cr (-2.8111, 5.1348, -2.0003) [0.0157, 0.7977, 0.0157]
PeriodicSite: Cr (0.0279, 0.0475, 6.1852) [0.0157, 0.0157, 0.7976]
PeriodicSite: Cr (5.8535, 0.0475, -2.0004) [0.7976, 0.0157, 0.0157]
PeriodicSite: Cr (6.0631, 2.0162, 4.3142) [0.9883, 0.3333, 0.9883]
PeriodicSite: Cr (3.6852, 6.2772, -2.5420) [0.9883, 0.9883, 0.3333]
PeriodicSite: Cr (-1.1945, 6.2772, 4.3145) [0.3333, 0.9883, 0.9883]
PeriodicSite: Cr (2.6272, 0.0580, 1.8695) [0.3645, 0.0165, 0.3646]
PeriodicSite: Cr (1.3633, 2.3223, -1.7743) [0.3645, 0.3645, 0.0165]
PeriodicSite: Cr (-1.2298, 2.3221, 1.8693) [0.0164, 0.3645, 0.3645]</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>vrun</span><span class=o>.</span><span class=n>final_energy</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_text output_subarea output_execute_result"> <pre>
<code>-157.80974238</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>Another useful set of data is stored under <code>.ionic_steps</code> because this contains information on how the calculation progressed during each ionic step in the structure optimization.</p> <p>We can check how many ionic steps were taken and what properties are stored for each ionic step. </p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=nb>len</span><span class=p>(</span><span class=n>vrun</span><span class=o>.</span><span class=n>ionic_steps</span><span class=p>)</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_text output_subarea output_execute_result"> <pre>
<code>4</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>vrun</span><span class=o>.</span><span class=n>ionic_steps</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>keys</span><span class=p>()</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_text output_subarea output_execute_result"> <pre>
<code>dict_keys([&#39;e_fr_energy&#39;, &#39;e_wo_entrp&#39;, &#39;e_0_energy&#39;, &#39;forces&#39;, &#39;stress&#39;, &#39;electronic_steps&#39;, &#39;structure&#39;])</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>By looping through we can see the energy at the end of each ionic step and how many electronic steps were required during each ionic step.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>vrun</span><span class=o>.</span><span class=n>ionic_steps</span><span class=p>:</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>[</span><span class=s2>&quot;e_fr_energy&quot;</span><span class=p>]</span> <span class=p>,</span><span class=nb>len</span><span class=p>(</span><span class=n>i</span><span class=p>[</span><span class=s2>&quot;electronic_steps&quot;</span><span class=p>]))</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_subarea output_stream output_stdout output_text"> <pre>
<code>-157.49049217 18
-157.58170253 13
-157.69641768 27
-157.80974238 10
</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h3 id=parsing-directories-with-atomate-drones>Parsing Directories with Atomate Drones<a class=headerlink href=#parsing-directories-with-atomate-drones title="Permanent link">&para;</a></h3> <p>To take parsing outputs from external codes one step further, we will introduce the concept of <code>drones</code> from the python code package, <code>atomate</code>. Pymatgen provides methods for parsing individual output files. Atomate drones combine these capabilities to parse entire output calculation directories and has an <code>.assimilate()</code> methode to produce a dictionary summarizing the results. This dictionary representation is helpful because it can be stored in a database as done with the Materials Project.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>atomate.vasp.drones</span> <span class=kn>import</span> <span class=n>VaspDrone</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>drone</span> <span class=o>=</span> <span class=n>VaspDrone</span><span class=p>()</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>task_doc</span> <span class=o>=</span> <span class=n>drone</span><span class=o>.</span><span class=n>assimilate</span><span class=p>(</span><span class=n>path</span><span class=o>=</span><span class=s2>&quot;./example_VASP_Al16Cr10&quot;</span><span class=p>)</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_subarea output_stream output_stdout output_text"> <pre>
<code>2021-08-05 19:49:58,263 INFO atomate.vasp.drones Getting task doc for base dir :./example_VASP_Al16Cr10
2021-08-05 19:50:00,370 INFO atomate.vasp.drones Post-processing dir:./example_VASP_Al16Cr10
2021-08-05 19:50:00,371 WARNING atomate.vasp.drones Transformations file does not exist.
2021-08-05 19:50:00,374 INFO atomate.vasp.drones Post-processed /home/runner/work/workshop/workshop/workshop/lessons/05_automated_dft/example_VASP_Al16Cr10
</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=nb>print</span><span class=p>(</span><span class=n>task_doc</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_subarea output_stream output_stdout output_text"> <pre>
<code>dict_keys([&#39;schema&#39;, &#39;dir_name&#39;, &#39;calcs_reversed&#39;, &#39;run_stats&#39;, &#39;chemsys&#39;, &#39;formula_anonymous&#39;, &#39;formula_reduced_abc&#39;, &#39;completed_at&#39;, &#39;nsites&#39;, &#39;composition_unit_cell&#39;, &#39;composition_reduced&#39;, &#39;formula_pretty&#39;, &#39;elements&#39;, &#39;nelements&#39;, &#39;input&#39;, &#39;output&#39;, &#39;state&#39;, &#39;analysis&#39;, &#39;last_updated&#39;, &#39;transformations&#39;])
</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h2 id=lesson-3-database-automation>Lesson 3: Database Automation<a class=headerlink href=#lesson-3-database-automation title="Permanent link">&para;</a></h2> <p>The final section of this lesson focuses on automating DFT using our <code>atomate</code> code. <code>atomate</code> is a set of recipes for computing properties for both molecules and structures. The workflows in <code>atomate</code> run on <code>fireworks</code>, our workflow management software. <code>fireworks</code> stores workflow information and calculation summaries in MongoDB. Using this infrastructure MP routinely manages 10,000 simultaneous calculations on supercomputers such as Cori at NERSC. </p> <h3 id=getting-workflows>Getting Workflows<a class=headerlink href=#getting-workflows title="Permanent link">&para;</a></h3> <p>Let's begin by importing a basic silicon structure</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>pymatgen.core</span> <span class=kn>import</span> <span class=n>Structure</span>
<span class=n>si</span> <span class=o>=</span> <span class=n>Structure</span><span class=o>.</span><span class=n>from_file</span><span class=p>(</span><span class=s2>&quot;./example_files/Si.CIF&quot;</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=n>si</span><span class=p>)</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_subarea output_stream output_stdout output_text"> <pre>
<code>Full Formula (Si8)
Reduced Formula: Si
abc   :   5.523145   5.468728   5.468728
angles:  90.000000  90.000000  90.000000
Sites (8)
  #  SP       a     b     c
---  ----  ----  ----  ----
  0  Si    0.25  0.25  0.25
  1  Si    0.5   0.5   0
  2  Si    0.25  0.75  0.75
  3  Si    0.5   0     0.5
  4  Si    0.75  0.25  0.75
  5  Si    0     0.5   0.5
  6  Si    0.75  0.75  0.25
  7  Si    0     0     0
</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>In the past two lessons we've gone over some of the machinery used in this automation. Atomate workflows (with the support of fireworks) compiles everything needed to: * Store workflow inputs from the user * Create new calculation directories and write input files * Parse output directories and store results in a MongoDB database</p> <p>We can import <code>workflows</code> from atomate which are essentially the recipes that outline the steps for how to automate calculations from start to finish. There are many pre-built workflows in automate for common types of calculations. The best way to explore all available workflows is by checking the atomate source code linked below. * VASP Workflows: https://github.com/hackingmaterials/atomate/tree/main/atomate/vasp/workflows/base * Q-Chem Workflows: https://github.com/hackingmaterials/atomate/tree/main/atomate/qchem/workflows/base</p> <p>For this lesson, we will focus on two types of workflows for VASP. * Structure Optimization Workflow (simpler) * Bandstructure Workflow (more complex)</p> <p>Let's get started by importing these workflows and then creating workflow objects from our silicon structure.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>atomate.vasp.workflows.presets.core</span> <span class=kn>import</span> <span class=n>wf_structure_optimization</span><span class=p>,</span> <span class=n>wf_bandstructure</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>so_wf</span> <span class=o>=</span> <span class=n>wf_structure_optimization</span><span class=p>(</span><span class=n>structure</span><span class=o>=</span><span class=n>si</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=n>so_wf</span><span class=p>)</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_subarea output_stream output_stdout output_text"> <pre>
<code>Workflow object: (fw_ids: odict_keys([-1]) , name: Si)
</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>bs_wf</span> <span class=o>=</span> <span class=n>wf_bandstructure</span><span class=p>(</span><span class=n>structure</span><span class=o>=</span><span class=n>si</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=n>bs_wf</span><span class=p>)</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_subarea output_stream output_stdout output_text"> <pre>
<code>Workflow object: (fw_ids: odict_keys([-2, -3, -4, -5]) , name: Si)
</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>The structure optimization workflow is simpler and we can see that it only contains one firework. The bandstructure workflow has four fireworks so we can assume it is more complex. Let's see a graphical representation of each of these workflows.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>mp_workshop.atomate</span> <span class=kn>import</span> <span class=n>wf_to_graph</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>wf_to_graph</span><span class=p>(</span><span class=n>so_wf</span><span class=p>)</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_subarea output_text output_error"> <pre>
<span class=ansi-red-fg>---------------------------------------------------------------------------</span>
<span class=ansi-red-fg>FileNotFoundError</span>                         Traceback (most recent call last)
<span class=ansi-green-fg>/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/graphviz/backend.py</span> in <span class=ansi-cyan-fg>run</span><span class=ansi-blue-fg>(cmd, input, capture_output, check, encoding, quiet, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    169</span>     <span class=ansi-green-fg>try</span><span class=ansi-blue-fg>:</span>
<span class=ansi-green-fg>--&gt; 170</span><span class=ansi-red-fg>         </span>proc <span class=ansi-blue-fg>=</span> subprocess<span class=ansi-blue-fg>.</span>Popen<span class=ansi-blue-fg>(</span>cmd<span class=ansi-blue-fg>,</span> startupinfo<span class=ansi-blue-fg>=</span>get_startupinfo<span class=ansi-blue-fg>(</span><span class=ansi-blue-fg>)</span><span class=ansi-blue-fg>,</span> <span class=ansi-blue-fg>**</span>kwargs<span class=ansi-blue-fg>)</span>
<span class="ansi-green-intense-fg ansi-bold">    171</span>     <span class=ansi-green-fg>except</span> OSError <span class=ansi-green-fg>as</span> e<span class=ansi-blue-fg>:</span>

<span class=ansi-green-fg>/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/subprocess.py</span> in <span class=ansi-cyan-fg>__init__</span><span class=ansi-blue-fg>(self, args, bufsize, executable, stdin, stdout, stderr, preexec_fn, close_fds, shell, cwd, env, universal_newlines, startupinfo, creationflags, restore_signals, start_new_session, pass_fds, encoding, errors, text)</span>
<span class="ansi-green-intense-fg ansi-bold">    857</span> 
<span class=ansi-green-fg>--&gt; 858</span><span class=ansi-red-fg>             self._execute_child(args, executable, preexec_fn, close_fds,
</span><span class="ansi-green-intense-fg ansi-bold">    859</span>                                 pass_fds<span class=ansi-blue-fg>,</span> cwd<span class=ansi-blue-fg>,</span> env<span class=ansi-blue-fg>,</span>

<span class=ansi-green-fg>/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/subprocess.py</span> in <span class=ansi-cyan-fg>_execute_child</span><span class=ansi-blue-fg>(self, args, executable, preexec_fn, close_fds, pass_fds, cwd, env, startupinfo, creationflags, shell, p2cread, p2cwrite, c2pread, c2pwrite, errread, errwrite, restore_signals, start_new_session)</span>
<span class="ansi-green-intense-fg ansi-bold">   1703</span>                         err_msg <span class=ansi-blue-fg>=</span> os<span class=ansi-blue-fg>.</span>strerror<span class=ansi-blue-fg>(</span>errno_num<span class=ansi-blue-fg>)</span>
<span class=ansi-green-fg>-&gt; 1704</span><span class=ansi-red-fg>                     </span><span class=ansi-green-fg>raise</span> child_exception_type<span class=ansi-blue-fg>(</span>errno_num<span class=ansi-blue-fg>,</span> err_msg<span class=ansi-blue-fg>,</span> err_filename<span class=ansi-blue-fg>)</span>
<span class="ansi-green-intense-fg ansi-bold">   1705</span>                 <span class=ansi-green-fg>raise</span> child_exception_type<span class=ansi-blue-fg>(</span>err_msg<span class=ansi-blue-fg>)</span>

<span class=ansi-red-fg>FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;dot&#39;

The above exception was the direct cause of the following exception:

<span class=ansi-red-fg>ExecutableNotFound</span>                        Traceback (most recent call last)
<span class=ansi-green-fg>/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/IPython/core/formatters.py</span> in <span class=ansi-cyan-fg>__call__</span><span class=ansi-blue-fg>(self, obj)</span>
<span class="ansi-green-intense-fg ansi-bold">    343</span>             method <span class=ansi-blue-fg>=</span> get_real_method<span class=ansi-blue-fg>(</span>obj<span class=ansi-blue-fg>,</span> self<span class=ansi-blue-fg>.</span>print_method<span class=ansi-blue-fg>)</span>
<span class="ansi-green-intense-fg ansi-bold">    344</span>             <span class=ansi-green-fg>if</span> method <span class=ansi-green-fg>is</span> <span class=ansi-green-fg>not</span> <span class=ansi-green-fg>None</span><span class=ansi-blue-fg>:</span>
<span class=ansi-green-fg>--&gt; 345</span><span class=ansi-red-fg>                 </span><span class=ansi-green-fg>return</span> method<span class=ansi-blue-fg>(</span><span class=ansi-blue-fg>)</span>
<span class="ansi-green-intense-fg ansi-bold">    346</span>             <span class=ansi-green-fg>return</span> <span class=ansi-green-fg>None</span>
<span class="ansi-green-intense-fg ansi-bold">    347</span>         <span class=ansi-green-fg>else</span><span class=ansi-blue-fg>:</span>

<span class=ansi-green-fg>/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/graphviz/files.py</span> in <span class=ansi-cyan-fg>_repr_svg_</span><span class=ansi-blue-fg>(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    139</span> 
<span class="ansi-green-intense-fg ansi-bold">    140</span>     <span class=ansi-green-fg>def</span> _repr_svg_<span class=ansi-blue-fg>(</span>self<span class=ansi-blue-fg>)</span><span class=ansi-blue-fg>:</span>
<span class=ansi-green-fg>--&gt; 141</span><span class=ansi-red-fg>         </span><span class=ansi-green-fg>return</span> self<span class=ansi-blue-fg>.</span>pipe<span class=ansi-blue-fg>(</span>format<span class=ansi-blue-fg>=</span><span class=ansi-blue-fg>&#39;svg&#39;</span><span class=ansi-blue-fg>)</span><span class=ansi-blue-fg>.</span>decode<span class=ansi-blue-fg>(</span>self<span class=ansi-blue-fg>.</span>_encoding<span class=ansi-blue-fg>)</span>
<span class="ansi-green-intense-fg ansi-bold">    142</span> 
<span class="ansi-green-intense-fg ansi-bold">    143</span>     <span class=ansi-green-fg>def</span> pipe<span class=ansi-blue-fg>(</span>self<span class=ansi-blue-fg>,</span> format<span class=ansi-blue-fg>=</span><span class=ansi-green-fg>None</span><span class=ansi-blue-fg>,</span> renderer<span class=ansi-blue-fg>=</span><span class=ansi-green-fg>None</span><span class=ansi-blue-fg>,</span> formatter<span class=ansi-blue-fg>=</span><span class=ansi-green-fg>None</span><span class=ansi-blue-fg>,</span> quiet<span class=ansi-blue-fg>=</span><span class=ansi-green-fg>False</span><span class=ansi-blue-fg>)</span><span class=ansi-blue-fg>:</span>

<span class=ansi-green-fg>/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/graphviz/files.py</span> in <span class=ansi-cyan-fg>pipe</span><span class=ansi-blue-fg>(self, format, renderer, formatter, quiet)</span>
<span class="ansi-green-intense-fg ansi-bold">    164</span>         data <span class=ansi-blue-fg>=</span> self<span class=ansi-blue-fg>.</span>source<span class=ansi-blue-fg>.</span>encode<span class=ansi-blue-fg>(</span>self<span class=ansi-blue-fg>.</span>_encoding<span class=ansi-blue-fg>)</span>
<span class="ansi-green-intense-fg ansi-bold">    165</span> 
<span class=ansi-green-fg>--&gt; 166</span><span class=ansi-red-fg>         out = backend.pipe(self._engine, format, data,
</span><span class="ansi-green-intense-fg ansi-bold">    167</span>                            renderer<span class=ansi-blue-fg>=</span>renderer<span class=ansi-blue-fg>,</span> formatter<span class=ansi-blue-fg>=</span>formatter<span class=ansi-blue-fg>,</span>
<span class="ansi-green-intense-fg ansi-bold">    168</span>                            quiet=quiet)

<span class=ansi-green-fg>/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/graphviz/backend.py</span> in <span class=ansi-cyan-fg>pipe</span><span class=ansi-blue-fg>(engine, format, data, renderer, formatter, quiet)</span>
<span class="ansi-green-intense-fg ansi-bold">    266</span>     &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    267</span>     cmd<span class=ansi-blue-fg>,</span> _ <span class=ansi-blue-fg>=</span> command<span class=ansi-blue-fg>(</span>engine<span class=ansi-blue-fg>,</span> format<span class=ansi-blue-fg>,</span> <span class=ansi-green-fg>None</span><span class=ansi-blue-fg>,</span> renderer<span class=ansi-blue-fg>,</span> formatter<span class=ansi-blue-fg>)</span>
<span class=ansi-green-fg>--&gt; 268</span><span class=ansi-red-fg>     </span>out<span class=ansi-blue-fg>,</span> _ <span class=ansi-blue-fg>=</span> run<span class=ansi-blue-fg>(</span>cmd<span class=ansi-blue-fg>,</span> input<span class=ansi-blue-fg>=</span>data<span class=ansi-blue-fg>,</span> capture_output<span class=ansi-blue-fg>=</span><span class=ansi-green-fg>True</span><span class=ansi-blue-fg>,</span> check<span class=ansi-blue-fg>=</span><span class=ansi-green-fg>True</span><span class=ansi-blue-fg>,</span> quiet<span class=ansi-blue-fg>=</span>quiet<span class=ansi-blue-fg>)</span>
<span class="ansi-green-intense-fg ansi-bold">    269</span>     <span class=ansi-green-fg>return</span> out
<span class="ansi-green-intense-fg ansi-bold">    270</span> 

<span class=ansi-green-fg>/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/graphviz/backend.py</span> in <span class=ansi-cyan-fg>run</span><span class=ansi-blue-fg>(cmd, input, capture_output, check, encoding, quiet, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    171</span>     <span class=ansi-green-fg>except</span> OSError <span class=ansi-green-fg>as</span> e<span class=ansi-blue-fg>:</span>
<span class="ansi-green-intense-fg ansi-bold">    172</span>         <span class=ansi-green-fg>if</span> e<span class=ansi-blue-fg>.</span>errno <span class=ansi-blue-fg>==</span> errno<span class=ansi-blue-fg>.</span>ENOENT<span class=ansi-blue-fg>:</span>
<span class=ansi-green-fg>--&gt; 173</span><span class=ansi-red-fg>             </span><span class=ansi-green-fg>raise</span> ExecutableNotFound<span class=ansi-blue-fg>(</span>cmd<span class=ansi-blue-fg>)</span> <span class=ansi-green-fg>from</span> e
<span class="ansi-green-intense-fg ansi-bold">    174</span>         <span class=ansi-green-fg>else</span><span class=ansi-blue-fg>:</span>
<span class="ansi-green-intense-fg ansi-bold">    175</span>             <span class=ansi-green-fg>raise</span>

<span class=ansi-red-fg>ExecutableNotFound</span>: failed to execute &#39;dot&#39;, make sure the Graphviz executables are on your systems&#39; PATH</pre> </div> </div> <div class=output_area> <div class="output_text output_subarea output_execute_result"> <pre>
<code>&lt;graphviz.dot.Digraph at 0x7f937cd74610&gt;</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>wf_to_graph</span><span class=p>(</span><span class=n>bs_wf</span><span class=p>)</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_subarea output_text output_error"> <pre>
<span class=ansi-red-fg>---------------------------------------------------------------------------</span>
<span class=ansi-red-fg>FileNotFoundError</span>                         Traceback (most recent call last)
<span class=ansi-green-fg>/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/graphviz/backend.py</span> in <span class=ansi-cyan-fg>run</span><span class=ansi-blue-fg>(cmd, input, capture_output, check, encoding, quiet, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    169</span>     <span class=ansi-green-fg>try</span><span class=ansi-blue-fg>:</span>
<span class=ansi-green-fg>--&gt; 170</span><span class=ansi-red-fg>         </span>proc <span class=ansi-blue-fg>=</span> subprocess<span class=ansi-blue-fg>.</span>Popen<span class=ansi-blue-fg>(</span>cmd<span class=ansi-blue-fg>,</span> startupinfo<span class=ansi-blue-fg>=</span>get_startupinfo<span class=ansi-blue-fg>(</span><span class=ansi-blue-fg>)</span><span class=ansi-blue-fg>,</span> <span class=ansi-blue-fg>**</span>kwargs<span class=ansi-blue-fg>)</span>
<span class="ansi-green-intense-fg ansi-bold">    171</span>     <span class=ansi-green-fg>except</span> OSError <span class=ansi-green-fg>as</span> e<span class=ansi-blue-fg>:</span>

<span class=ansi-green-fg>/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/subprocess.py</span> in <span class=ansi-cyan-fg>__init__</span><span class=ansi-blue-fg>(self, args, bufsize, executable, stdin, stdout, stderr, preexec_fn, close_fds, shell, cwd, env, universal_newlines, startupinfo, creationflags, restore_signals, start_new_session, pass_fds, encoding, errors, text)</span>
<span class="ansi-green-intense-fg ansi-bold">    857</span> 
<span class=ansi-green-fg>--&gt; 858</span><span class=ansi-red-fg>             self._execute_child(args, executable, preexec_fn, close_fds,
</span><span class="ansi-green-intense-fg ansi-bold">    859</span>                                 pass_fds<span class=ansi-blue-fg>,</span> cwd<span class=ansi-blue-fg>,</span> env<span class=ansi-blue-fg>,</span>

<span class=ansi-green-fg>/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/subprocess.py</span> in <span class=ansi-cyan-fg>_execute_child</span><span class=ansi-blue-fg>(self, args, executable, preexec_fn, close_fds, pass_fds, cwd, env, startupinfo, creationflags, shell, p2cread, p2cwrite, c2pread, c2pwrite, errread, errwrite, restore_signals, start_new_session)</span>
<span class="ansi-green-intense-fg ansi-bold">   1703</span>                         err_msg <span class=ansi-blue-fg>=</span> os<span class=ansi-blue-fg>.</span>strerror<span class=ansi-blue-fg>(</span>errno_num<span class=ansi-blue-fg>)</span>
<span class=ansi-green-fg>-&gt; 1704</span><span class=ansi-red-fg>                     </span><span class=ansi-green-fg>raise</span> child_exception_type<span class=ansi-blue-fg>(</span>errno_num<span class=ansi-blue-fg>,</span> err_msg<span class=ansi-blue-fg>,</span> err_filename<span class=ansi-blue-fg>)</span>
<span class="ansi-green-intense-fg ansi-bold">   1705</span>                 <span class=ansi-green-fg>raise</span> child_exception_type<span class=ansi-blue-fg>(</span>err_msg<span class=ansi-blue-fg>)</span>

<span class=ansi-red-fg>FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;dot&#39;

The above exception was the direct cause of the following exception:

<span class=ansi-red-fg>ExecutableNotFound</span>                        Traceback (most recent call last)
<span class=ansi-green-fg>/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/IPython/core/formatters.py</span> in <span class=ansi-cyan-fg>__call__</span><span class=ansi-blue-fg>(self, obj)</span>
<span class="ansi-green-intense-fg ansi-bold">    343</span>             method <span class=ansi-blue-fg>=</span> get_real_method<span class=ansi-blue-fg>(</span>obj<span class=ansi-blue-fg>,</span> self<span class=ansi-blue-fg>.</span>print_method<span class=ansi-blue-fg>)</span>
<span class="ansi-green-intense-fg ansi-bold">    344</span>             <span class=ansi-green-fg>if</span> method <span class=ansi-green-fg>is</span> <span class=ansi-green-fg>not</span> <span class=ansi-green-fg>None</span><span class=ansi-blue-fg>:</span>
<span class=ansi-green-fg>--&gt; 345</span><span class=ansi-red-fg>                 </span><span class=ansi-green-fg>return</span> method<span class=ansi-blue-fg>(</span><span class=ansi-blue-fg>)</span>
<span class="ansi-green-intense-fg ansi-bold">    346</span>             <span class=ansi-green-fg>return</span> <span class=ansi-green-fg>None</span>
<span class="ansi-green-intense-fg ansi-bold">    347</span>         <span class=ansi-green-fg>else</span><span class=ansi-blue-fg>:</span>

<span class=ansi-green-fg>/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/graphviz/files.py</span> in <span class=ansi-cyan-fg>_repr_svg_</span><span class=ansi-blue-fg>(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    139</span> 
<span class="ansi-green-intense-fg ansi-bold">    140</span>     <span class=ansi-green-fg>def</span> _repr_svg_<span class=ansi-blue-fg>(</span>self<span class=ansi-blue-fg>)</span><span class=ansi-blue-fg>:</span>
<span class=ansi-green-fg>--&gt; 141</span><span class=ansi-red-fg>         </span><span class=ansi-green-fg>return</span> self<span class=ansi-blue-fg>.</span>pipe<span class=ansi-blue-fg>(</span>format<span class=ansi-blue-fg>=</span><span class=ansi-blue-fg>&#39;svg&#39;</span><span class=ansi-blue-fg>)</span><span class=ansi-blue-fg>.</span>decode<span class=ansi-blue-fg>(</span>self<span class=ansi-blue-fg>.</span>_encoding<span class=ansi-blue-fg>)</span>
<span class="ansi-green-intense-fg ansi-bold">    142</span> 
<span class="ansi-green-intense-fg ansi-bold">    143</span>     <span class=ansi-green-fg>def</span> pipe<span class=ansi-blue-fg>(</span>self<span class=ansi-blue-fg>,</span> format<span class=ansi-blue-fg>=</span><span class=ansi-green-fg>None</span><span class=ansi-blue-fg>,</span> renderer<span class=ansi-blue-fg>=</span><span class=ansi-green-fg>None</span><span class=ansi-blue-fg>,</span> formatter<span class=ansi-blue-fg>=</span><span class=ansi-green-fg>None</span><span class=ansi-blue-fg>,</span> quiet<span class=ansi-blue-fg>=</span><span class=ansi-green-fg>False</span><span class=ansi-blue-fg>)</span><span class=ansi-blue-fg>:</span>

<span class=ansi-green-fg>/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/graphviz/files.py</span> in <span class=ansi-cyan-fg>pipe</span><span class=ansi-blue-fg>(self, format, renderer, formatter, quiet)</span>
<span class="ansi-green-intense-fg ansi-bold">    164</span>         data <span class=ansi-blue-fg>=</span> self<span class=ansi-blue-fg>.</span>source<span class=ansi-blue-fg>.</span>encode<span class=ansi-blue-fg>(</span>self<span class=ansi-blue-fg>.</span>_encoding<span class=ansi-blue-fg>)</span>
<span class="ansi-green-intense-fg ansi-bold">    165</span> 
<span class=ansi-green-fg>--&gt; 166</span><span class=ansi-red-fg>         out = backend.pipe(self._engine, format, data,
</span><span class="ansi-green-intense-fg ansi-bold">    167</span>                            renderer<span class=ansi-blue-fg>=</span>renderer<span class=ansi-blue-fg>,</span> formatter<span class=ansi-blue-fg>=</span>formatter<span class=ansi-blue-fg>,</span>
<span class="ansi-green-intense-fg ansi-bold">    168</span>                            quiet=quiet)

<span class=ansi-green-fg>/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/graphviz/backend.py</span> in <span class=ansi-cyan-fg>pipe</span><span class=ansi-blue-fg>(engine, format, data, renderer, formatter, quiet)</span>
<span class="ansi-green-intense-fg ansi-bold">    266</span>     &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    267</span>     cmd<span class=ansi-blue-fg>,</span> _ <span class=ansi-blue-fg>=</span> command<span class=ansi-blue-fg>(</span>engine<span class=ansi-blue-fg>,</span> format<span class=ansi-blue-fg>,</span> <span class=ansi-green-fg>None</span><span class=ansi-blue-fg>,</span> renderer<span class=ansi-blue-fg>,</span> formatter<span class=ansi-blue-fg>)</span>
<span class=ansi-green-fg>--&gt; 268</span><span class=ansi-red-fg>     </span>out<span class=ansi-blue-fg>,</span> _ <span class=ansi-blue-fg>=</span> run<span class=ansi-blue-fg>(</span>cmd<span class=ansi-blue-fg>,</span> input<span class=ansi-blue-fg>=</span>data<span class=ansi-blue-fg>,</span> capture_output<span class=ansi-blue-fg>=</span><span class=ansi-green-fg>True</span><span class=ansi-blue-fg>,</span> check<span class=ansi-blue-fg>=</span><span class=ansi-green-fg>True</span><span class=ansi-blue-fg>,</span> quiet<span class=ansi-blue-fg>=</span>quiet<span class=ansi-blue-fg>)</span>
<span class="ansi-green-intense-fg ansi-bold">    269</span>     <span class=ansi-green-fg>return</span> out
<span class="ansi-green-intense-fg ansi-bold">    270</span> 

<span class=ansi-green-fg>/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/graphviz/backend.py</span> in <span class=ansi-cyan-fg>run</span><span class=ansi-blue-fg>(cmd, input, capture_output, check, encoding, quiet, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    171</span>     <span class=ansi-green-fg>except</span> OSError <span class=ansi-green-fg>as</span> e<span class=ansi-blue-fg>:</span>
<span class="ansi-green-intense-fg ansi-bold">    172</span>         <span class=ansi-green-fg>if</span> e<span class=ansi-blue-fg>.</span>errno <span class=ansi-blue-fg>==</span> errno<span class=ansi-blue-fg>.</span>ENOENT<span class=ansi-blue-fg>:</span>
<span class=ansi-green-fg>--&gt; 173</span><span class=ansi-red-fg>             </span><span class=ansi-green-fg>raise</span> ExecutableNotFound<span class=ansi-blue-fg>(</span>cmd<span class=ansi-blue-fg>)</span> <span class=ansi-green-fg>from</span> e
<span class="ansi-green-intense-fg ansi-bold">    174</span>         <span class=ansi-green-fg>else</span><span class=ansi-blue-fg>:</span>
<span class="ansi-green-intense-fg ansi-bold">    175</span>             <span class=ansi-green-fg>raise</span>

<span class=ansi-red-fg>ExecutableNotFound</span>: failed to execute &#39;dot&#39;, make sure the Graphviz executables are on your systems&#39; PATH</pre> </div> </div> <div class=output_area> <div class="output_text output_subarea output_execute_result"> <pre>
<code>&lt;graphviz.dot.Digraph at 0x7f937cd74a90&gt;</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>The exact steps in each firework can vary but for these cases, each firework roughly represents one VASP calculation which consists of the following steps:</p> <div class=codehilite><pre><span></span><code><span class=mf>1.</span> <span class=n>Write</span> <span class=n>VASP</span> <span class=kr>input</span> <span class=n>files</span>
<span class=mf>2.</span> <span class=kr>Run</span> <span class=n>VASP</span>
<span class=mf>3.</span> <span class=n>Parse</span> <span class=n>VASP</span> <span class=n>output</span> <span class=n>files</span>
</code></pre></div> <p>In the more complex bandstructure workflow, we can see the fireworks are connected. That means the outputs from one firework are passed to the next firework so the VASP calculation can start from the relaxed structure of the previous calculation.</p> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>Before we move forward with running our workflows, we will make one modification called <code>use_fake_vasp_workshop</code>. This will change the fireworks in the workflows so they will not actually run VASP (which requires greater computer resources and a VASP license), but instead will simulate running VASP by copying over pre-existing VASP output files.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>mp_workshop.atomate</span> <span class=kn>import</span> <span class=n>use_fake_vasp_workshop</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>so_wf</span> <span class=o>=</span> <span class=n>use_fake_vasp_workshop</span><span class=p>(</span><span class=n>so_wf</span><span class=p>)</span>
<span class=n>bs_wf</span> <span class=o>=</span> <span class=n>use_fake_vasp_workshop</span><span class=p>(</span><span class=n>bs_wf</span><span class=p>)</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h3 id=launching-workflows-from-your-launchpad>Launching Workflows from Your LaunchPad<a class=headerlink href=#launching-workflows-from-your-launchpad title="Permanent link">&para;</a></h3> <p>Now we will introduce the <code>LaunchPad</code> from fireworks which is a python object that let's us interface with MongoDB and manage our queue of calculations. The LaunchPad allows you to submit and query workflows from anywhere you have database access. We need to get ourselves a LaunchPad object and set it up so we can submit our workflows.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>fireworks</span> <span class=kn>import</span> <span class=n>LaunchPad</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>lp</span> <span class=o>=</span> <span class=n>LaunchPad</span><span class=o>.</span><span class=n>auto_load</span><span class=p>()</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>lp</span><span class=o>.</span><span class=n>reset</span><span class=p>(</span><span class=n>password</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span><span class=n>require_password</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_subarea output_stream output_stdout output_text"> <pre>
<code>2021-08-05 19:50:00,537 INFO Performing db tune-up
2021-08-05 19:50:00,638 INFO LaunchPad was RESET.
</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>Note <code>lp.reset()</code> should only be executed one time when you are first initializing your database set-up. If you reset your LaunchPad at a later time, you will erase the record of past calcuations you have run.</p> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>Adding our workflows to our Launchpad will encode and store our workflow objects into MongoDB so they can be accessed later. Let's start by adding one workflow, the simpler structure optimization workflow.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>lp</span><span class=o>.</span><span class=n>add_wf</span><span class=p>(</span><span class=n>so_wf</span><span class=p>)</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_subarea output_stream output_stdout output_text"> <pre>
<code>2021-08-05 19:50:00,653 INFO Added a workflow. id_map: {-1: 1}
</code>
</pre> </div> </div> <div class=output_area> <div class="output_text output_subarea output_execute_result"> <pre>
<code>{-1: 1}</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>Now that a workflow is in our LaunchPad, we can check on its status using <code>.get_wf_summary_dict()</code></p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>lp</span><span class=o>.</span><span class=n>get_wf_summary_dict</span><span class=p>(</span><span class=n>fw_id</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_text output_subarea output_execute_result"> <pre>
<code>{&#39;state&#39;: &#39;READY&#39;,
 &#39;name&#39;: &#39;Si&#39;,
 &#39;created_on&#39;: datetime.datetime(2021, 8, 5, 19, 50, 0, 412000),
 &#39;updated_on&#39;: datetime.datetime(2021, 8, 5, 19, 50, 0, 412000),
 &#39;states&#39;: OrderedDict([(&#39;Si-structure optimization--1&#39;, &#39;READY&#39;)]),
 &#39;launch_dirs&#39;: OrderedDict([(&#39;Si-structure optimization--1&#39;, [])])}</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>Now that we a workflow in our LaunchPad, we are ready to run it. Normally we run fireworks through the command-line interface on supercomputers because external codes, such as VASP, require more compute resources. However, for today's demonstration, we will run our workflows locally in this notebook to illustrate how it works.</p> <p>Fireworks has a command called <code>rlaunch</code> for "launching" or running a firework in a workflow from our LaunchPad. Let's see how to use it and use "rapidfire" mode.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=err>!</span><span class=n>rlaunch</span> <span class=o>--</span><span class=n>help</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_subarea output_stream output_stdout output_text"> <pre>
<code>FW Echo Test: MP Workshop
usage: rlaunch [-h] [-l LAUNCHPAD_FILE] [-w FWORKER_FILE] [-c CONFIG_DIR]
               [--loglvl LOGLVL] [-s]
               {singleshot,rapidfire,multi} ...

This program launches one or more Rockets. A Rocket retrieves a job from the
central database and runs it. The &#34;single-shot&#34; option launches a single
Rocket, whereas the &#34;rapidfire&#34; option loops until all FireWorks are
completed.

positional arguments:
  {singleshot,rapidfire,multi}
                        command
    singleshot          launch a single Rocket
    rapidfire           launch multiple Rockets (loop until all FireWorks
                        complete)
    multi               launches multiple Rockets simultaneously

optional arguments:
  -h, --help            show this help message and exit
  -l LAUNCHPAD_FILE, --launchpad_file LAUNCHPAD_FILE
                        path to launchpad file
  -w FWORKER_FILE, --fworker_file FWORKER_FILE
                        path to fworker file
  -c CONFIG_DIR, --config_dir CONFIG_DIR
                        path to a directory containing the config file (used
                        if -l, -w unspecified)
  --loglvl LOGLVL       level to print log messages
  -s, --silencer        shortcut to mute log messages
</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=err>!</span><span class=n>rlaunch</span> <span class=n>rapidfire</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_subarea output_stream output_stdout output_text"> <pre>
<code>FW Echo Test: MP Workshop
2021-08-05 19:50:01,722 INFO Hostname/IP lookup (this will take a few seconds)
2021-08-05 19:50:03,195 INFO Created new dir /home/runner/work/workshop/workshop/workshop/lessons/05_automated_dft/launcher_2021-08-05-19-50-03-195408
2021-08-05 19:50:03,195 INFO Launching Rocket
2021-08-05 19:50:03,218 INFO RUNNING fw_id: 1 in directory: /home/runner/work/workshop/workshop/workshop/lessons/05_automated_dft/launcher_2021-08-05-19-50-03-195408
2021-08-05 19:50:03,226 INFO Task started: FileWriteTask.
2021-08-05 19:50:03,226 INFO Task completed: FileWriteTask 
2021-08-05 19:50:03,228 INFO Task started: {{atomate.vasp.firetasks.write_inputs.WriteVaspFromIOSet}}.
2021-08-05 19:50:03,350 INFO Task completed: {{atomate.vasp.firetasks.write_inputs.WriteVaspFromIOSet}} 
2021-08-05 19:50:03,353 INFO Task started: {{atomate.vasp.firetasks.run_calc.RunVaspFake}}.
2021-08-05 19:50:03,354 INFO atomate.vasp.firetasks.run_calc RunVaspFake: verified inputs successfully
2021-08-05 19:50:03,360 INFO atomate.vasp.firetasks.run_calc RunVaspFake: ran fake VASP, generated outputs
2021-08-05 19:50:03,360 INFO Task completed: {{atomate.vasp.firetasks.run_calc.RunVaspFake}} 
2021-08-05 19:50:03,362 INFO Task started: {{atomate.common.firetasks.glue_tasks.PassCalcLocs}}.
2021-08-05 19:50:03,362 INFO Task completed: {{atomate.common.firetasks.glue_tasks.PassCalcLocs}} 
2021-08-05 19:50:03,364 INFO Task started: {{atomate.vasp.firetasks.parse_outputs.VaspToDb}}.
2021-08-05 19:50:03,364 INFO atomate.vasp.firetasks.parse_outputs PARSING DIRECTORY: /home/runner/work/workshop/workshop/workshop/lessons/05_automated_dft/launcher_2021-08-05-19-50-03-195408
2021-08-05 19:50:03,364 INFO atomate.vasp.drones Getting task doc for base dir :/home/runner/work/workshop/workshop/workshop/lessons/05_automated_dft/launcher_2021-08-05-19-50-03-195408
/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/pymatgen/io/vasp/inputs.py:1792: UnknownPotcarWarning: POTCAR with symbol Si has metadata that does not match                          any VASP POTCAR known to pymatgen. The data in this                          POTCAR is known to match the following functionals:                          [&#39;PBE&#39;]
  warnings.warn(
2021-08-05 19:50:03,965 INFO atomate.vasp.drones Post-processing dir:/home/runner/work/workshop/workshop/workshop/lessons/05_automated_dft/launcher_2021-08-05-19-50-03-195408
2021-08-05 19:50:03,966 WARNING atomate.vasp.drones Transformations file does not exist.
2021-08-05 19:50:03,966 INFO atomate.vasp.drones Post-processed /home/runner/work/workshop/workshop/workshop/lessons/05_automated_dft/launcher_2021-08-05-19-50-03-195408
2021-08-05 19:50:04,015 INFO atomate.utils.database Inserting fv-az198-413.gjkxsqtjg41etoza45cw35jkyb.bx.internal.cloudapp.net:/home/runner/work/workshop/workshop/workshop/lessons/05_automated_dft/launcher_2021-08-05-19-50-03-195408 with taskid = 1
2021-08-05 19:50:04,023 INFO atomate.vasp.firetasks.parse_outputs Finished parsing with task_id: 1
2021-08-05 19:50:04,023 INFO Task completed: {{atomate.vasp.firetasks.parse_outputs.VaspToDb}} 
2021-08-05 19:50:04,039 INFO Rocket finished
</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>Let's check on our workflow in our LaunchPad to see how it has changed after launching one firework.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>lp</span><span class=o>.</span><span class=n>get_wf_summary_dict</span><span class=p>(</span><span class=n>fw_id</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_text output_subarea output_execute_result"> <pre>
<code>{&#39;state&#39;: &#39;COMPLETED&#39;,
 &#39;name&#39;: &#39;Si&#39;,
 &#39;created_on&#39;: datetime.datetime(2021, 8, 5, 19, 50, 0, 412000),
 &#39;updated_on&#39;: datetime.datetime(2021, 8, 5, 19, 50, 4, 33000),
 &#39;states&#39;: OrderedDict([(&#39;Si-structure optimization--1&#39;, &#39;COMPLETED&#39;)]),
 &#39;launch_dirs&#39;: OrderedDict([(&#39;Si-structure optimization--1&#39;,
               [&#39;/home/runner/work/workshop/workshop/workshop/lessons/05_automated_dft/launcher_2021-08-05-19-50-03-195408&#39;])])}</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>Great! We can see the state of the one firework in our workflow has changed to COMPLETED and now the workflow is done.</p> <p>Now let's try running the more complicated bandstructure workflow which has four fireworks. First let's add the workflow to our LaunchPad and look at its summary dictionary.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>lp</span><span class=o>.</span><span class=n>add_wf</span><span class=p>(</span><span class=n>bs_wf</span><span class=p>)</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_subarea output_stream output_stdout output_text"> <pre>
<code>2021-08-05 19:50:04,880 INFO Added a workflow. id_map: {-5: 2, -4: 3, -3: 4, -2: 5}
</code>
</pre> </div> </div> <div class=output_area> <div class="output_text output_subarea output_execute_result"> <pre>
<code>{-5: 2, -4: 3, -3: 4, -2: 5}</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>lp</span><span class=o>.</span><span class=n>get_wf_summary_dict</span><span class=p>(</span><span class=n>fw_id</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_text output_subarea output_execute_result"> <pre>
<code>{&#39;state&#39;: &#39;READY&#39;,
 &#39;name&#39;: &#39;Si&#39;,
 &#39;created_on&#39;: datetime.datetime(2021, 8, 5, 19, 50, 0, 425000),
 &#39;updated_on&#39;: datetime.datetime(2021, 8, 5, 19, 50, 0, 425000),
 &#39;states&#39;: OrderedDict([(&#39;Si-nscf line--2&#39;, &#39;WAITING&#39;),
              (&#39;Si-nscf uniform--3&#39;, &#39;WAITING&#39;),
              (&#39;Si-static--4&#39;, &#39;WAITING&#39;),
              (&#39;Si-structure optimization--5&#39;, &#39;READY&#39;)]),
 &#39;launch_dirs&#39;: OrderedDict([(&#39;Si-nscf line--2&#39;, []),
              (&#39;Si-nscf uniform--3&#39;, []),
              (&#39;Si-static--4&#39;, []),
              (&#39;Si-structure optimization--5&#39;, [])])}</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>Now let's move forward with running the workflow. Note that if the <code>--nlaunches</code> flag is not used, <code>rlaunch rapidfire</code> will continue to launch more fireworks from the LaunchPad until no "READY" fireworks remain. This is convenient for our case because we have 4 fireworks in our workflow that need to run.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=err>!</span><span class=n>rlaunch</span> <span class=n>rapidfire</span> 
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_subarea output_stream output_stdout output_text"> <pre>
<code>FW Echo Test: MP Workshop
2021-08-05 19:50:05,336 INFO Hostname/IP lookup (this will take a few seconds)
2021-08-05 19:50:06,800 INFO Created new dir /home/runner/work/workshop/workshop/workshop/lessons/05_automated_dft/launcher_2021-08-05-19-50-06-800882
2021-08-05 19:50:06,801 INFO Launching Rocket
2021-08-05 19:50:06,825 INFO RUNNING fw_id: 5 in directory: /home/runner/work/workshop/workshop/workshop/lessons/05_automated_dft/launcher_2021-08-05-19-50-06-800882
2021-08-05 19:50:06,834 INFO Task started: FileWriteTask.
2021-08-05 19:50:06,834 INFO Task completed: FileWriteTask 
2021-08-05 19:50:06,835 INFO Task started: {{atomate.vasp.firetasks.write_inputs.WriteVaspFromIOSet}}.
2021-08-05 19:50:06,960 INFO Task completed: {{atomate.vasp.firetasks.write_inputs.WriteVaspFromIOSet}} 
2021-08-05 19:50:06,963 INFO Task started: {{atomate.vasp.firetasks.run_calc.RunVaspFake}}.
2021-08-05 19:50:06,964 INFO atomate.vasp.firetasks.run_calc RunVaspFake: verified inputs successfully
2021-08-05 19:50:06,969 INFO atomate.vasp.firetasks.run_calc RunVaspFake: ran fake VASP, generated outputs
2021-08-05 19:50:06,969 INFO Task completed: {{atomate.vasp.firetasks.run_calc.RunVaspFake}} 
2021-08-05 19:50:06,971 INFO Task started: {{atomate.common.firetasks.glue_tasks.PassCalcLocs}}.
2021-08-05 19:50:06,972 INFO Task completed: {{atomate.common.firetasks.glue_tasks.PassCalcLocs}} 
2021-08-05 19:50:06,973 INFO Task started: {{atomate.vasp.firetasks.parse_outputs.VaspToDb}}.
2021-08-05 19:50:06,973 INFO atomate.vasp.firetasks.parse_outputs PARSING DIRECTORY: /home/runner/work/workshop/workshop/workshop/lessons/05_automated_dft/launcher_2021-08-05-19-50-06-800882
2021-08-05 19:50:06,973 INFO atomate.vasp.drones Getting task doc for base dir :/home/runner/work/workshop/workshop/workshop/lessons/05_automated_dft/launcher_2021-08-05-19-50-06-800882
/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/pymatgen/io/vasp/inputs.py:1792: UnknownPotcarWarning: POTCAR with symbol Si has metadata that does not match                          any VASP POTCAR known to pymatgen. The data in this                          POTCAR is known to match the following functionals:                          [&#39;PBE&#39;]
  warnings.warn(
2021-08-05 19:50:07,575 INFO atomate.vasp.drones Post-processing dir:/home/runner/work/workshop/workshop/workshop/lessons/05_automated_dft/launcher_2021-08-05-19-50-06-800882
2021-08-05 19:50:07,575 WARNING atomate.vasp.drones Transformations file does not exist.
2021-08-05 19:50:07,576 INFO atomate.vasp.drones Post-processed /home/runner/work/workshop/workshop/workshop/lessons/05_automated_dft/launcher_2021-08-05-19-50-06-800882
2021-08-05 19:50:07,582 INFO atomate.utils.database Inserting fv-az198-413.gjkxsqtjg41etoza45cw35jkyb.bx.internal.cloudapp.net:/home/runner/work/workshop/workshop/workshop/lessons/05_automated_dft/launcher_2021-08-05-19-50-06-800882 with taskid = 2
2021-08-05 19:50:07,590 INFO atomate.vasp.firetasks.parse_outputs Finished parsing with task_id: 2
2021-08-05 19:50:07,590 INFO Task completed: {{atomate.vasp.firetasks.parse_outputs.VaspToDb}} 
2021-08-05 19:50:07,608 INFO Rocket finished
2021-08-05 19:50:07,611 INFO Created new dir /home/runner/work/workshop/workshop/workshop/lessons/05_automated_dft/launcher_2021-08-05-19-50-07-611551
2021-08-05 19:50:07,611 INFO Launching Rocket
2021-08-05 19:50:07,623 INFO RUNNING fw_id: 4 in directory: /home/runner/work/workshop/workshop/workshop/lessons/05_automated_dft/launcher_2021-08-05-19-50-07-611551
2021-08-05 19:50:07,626 INFO Task started: FileWriteTask.
2021-08-05 19:50:07,626 INFO Task completed: FileWriteTask 
2021-08-05 19:50:07,628 INFO Task started: {{atomate.vasp.firetasks.glue_tasks.CopyVaspOutputs}}.
2021-08-05 19:50:07,635 INFO Task completed: {{atomate.vasp.firetasks.glue_tasks.CopyVaspOutputs}} 
2021-08-05 19:50:07,637 INFO Task started: {{atomate.vasp.firetasks.write_inputs.WriteVaspStaticFromPrev}}.
2021-08-05 19:50:07,910 INFO Task completed: {{atomate.vasp.firetasks.write_inputs.WriteVaspStaticFromPrev}} 
2021-08-05 19:50:07,913 INFO Task started: {{atomate.vasp.firetasks.run_calc.RunVaspFake}}.
2021-08-05 19:50:07,913 INFO atomate.vasp.firetasks.run_calc RunVaspFake: verified inputs successfully
2021-08-05 19:50:07,923 INFO atomate.vasp.firetasks.run_calc RunVaspFake: ran fake VASP, generated outputs
2021-08-05 19:50:07,923 INFO Task completed: {{atomate.vasp.firetasks.run_calc.RunVaspFake}} 
2021-08-05 19:50:07,925 INFO Task started: {{atomate.common.firetasks.glue_tasks.PassCalcLocs}}.
2021-08-05 19:50:07,925 INFO Task completed: {{atomate.common.firetasks.glue_tasks.PassCalcLocs}} 
2021-08-05 19:50:07,927 INFO Task started: {{atomate.vasp.firetasks.parse_outputs.VaspToDb}}.
2021-08-05 19:50:07,927 INFO atomate.vasp.firetasks.parse_outputs PARSING DIRECTORY: /home/runner/work/workshop/workshop/workshop/lessons/05_automated_dft/launcher_2021-08-05-19-50-07-611551
2021-08-05 19:50:07,927 INFO atomate.vasp.drones Getting task doc for base dir :/home/runner/work/workshop/workshop/workshop/lessons/05_automated_dft/launcher_2021-08-05-19-50-07-611551
2021-08-05 19:50:08,583 ERROR atomate.vasp.drones Traceback (most recent call last):
  File &#34;/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/atomate/vasp/drones.py&#34;, line 363, in generate_doc
    s.add_site_property(&#34;magmom&#34;, magmoms)
  File &#34;/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/pymatgen/core/structure.py&#34;, line 430, in add_site_property
    raise ValueError(&#34;Values must be same length as sites.&#34;)
ValueError: Values must be same length as sites.

2021-08-05 19:50:08,583 ERROR atomate.vasp.drones Error in /home/runner/work/workshop/workshop/workshop/lessons/05_automated_dft/launcher_2021-08-05-19-50-07-611551.
Traceback (most recent call last):
  File &#34;/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/atomate/vasp/drones.py&#34;, line 363, in generate_doc
    s.add_site_property(&#34;magmom&#34;, magmoms)
  File &#34;/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/pymatgen/core/structure.py&#34;, line 430, in add_site_property
    raise ValueError(&#34;Values must be same length as sites.&#34;)
ValueError: Values must be same length as sites.

Traceback (most recent call last):
  File &#34;/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/fireworks/core/rocket.py&#34;, line 262, in run
    m_action = t.run_task(my_spec)
  File &#34;/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/atomate/vasp/firetasks/parse_outputs.py&#34;, line 108, in run_task
    task_doc = drone.assimilate(calc_dir)
  File &#34;/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/atomate/vasp/drones.py&#34;, line 219, in assimilate
    d = self.generate_doc(path, vasprun_files, outcar_files)
  File &#34;/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/atomate/vasp/drones.py&#34;, line 363, in generate_doc
    s.add_site_property(&#34;magmom&#34;, magmoms)
  File &#34;/opt/hostedtoolcache/Python/3.8.11/x64/lib/python3.8/site-packages/pymatgen/core/structure.py&#34;, line 430, in add_site_property
    raise ValueError(&#34;Values must be same length as sites.&#34;)
ValueError: Values must be same length as sites.
2021-08-05 19:50:08,600 INFO Rocket finished
</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>Once <code>rlaunch rapidfire</code> has finished running, now we can check to see if this workflow completed successfully.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>lp</span><span class=o>.</span><span class=n>get_wf_summary_dict</span><span class=p>(</span><span class=n>fw_id</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</code></pre></div> </div> <div class=output_wrapper> <div class=output> <div class=output_area> <div class="output_text output_subarea output_execute_result"> <pre>
<code>{&#39;state&#39;: &#39;FIZZLED&#39;,
 &#39;name&#39;: &#39;Si&#39;,
 &#39;created_on&#39;: datetime.datetime(2021, 8, 5, 19, 50, 0, 425000),
 &#39;updated_on&#39;: datetime.datetime(2021, 8, 5, 19, 50, 8, 597000),
 &#39;states&#39;: OrderedDict([(&#39;Si-nscf line--2&#39;, &#39;WAITING&#39;),
              (&#39;Si-nscf uniform--3&#39;, &#39;WAITING&#39;),
              (&#39;Si-static--4&#39;, &#39;FIZZLED&#39;),
              (&#39;Si-structure optimization--5&#39;, &#39;COMPLETED&#39;)]),
 &#39;launch_dirs&#39;: OrderedDict([(&#39;Si-nscf line--2&#39;, []),
              (&#39;Si-nscf uniform--3&#39;, []),
              (&#39;Si-static--4&#39;,
               [&#39;/home/runner/work/workshop/workshop/workshop/lessons/05_automated_dft/launcher_2021-08-05-19-50-07-611551&#39;]),
              (&#39;Si-structure optimization--5&#39;,
               [&#39;/home/runner/work/workshop/workshop/workshop/lessons/05_automated_dft/launcher_2021-08-05-19-50-06-800882&#39;])])}</code>
</pre> </div> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>Fireworks also has a command called <code>qlaunch</code> to automatically submit jobs to the supercomputer to run. Upon the job starting on the supercomputer, rlaunch from fireworks will be called thus running fireworks with supercomputer resources. qlaunch is the primary command used by users in the command-line interface on supercomputers.</p> </div> </div> </div> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../04_materials_api/MAPI%20Lesson%20%28filled%29/ class="md-footer__link md-footer__link--prev" aria-label="Previous: The Materials API" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> The Materials API </div> </div> </a> <a href=../../06_new_systems/06%20-%20New%20Systems%20-%20filled/ class="md-footer__link md-footer__link--next" aria-label="Next: Exploring New Systems" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Exploring New Systems </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Built by The Materials Project </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["instant", "tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.709b4209.min.js", "version": null}</script> <script src=../../../assets/javascripts/bundle.2b46852b.min.js></script> <script src=../../../assets/config.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>